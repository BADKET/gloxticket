{"version":3,"file":"claim.js","sourceRoot":"/","sources":["utils/claim.ts"],"names":[],"mappings":"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","sourcesContent":["/*\nCopyright 2026 BADKET\n*/\nimport { APIButtonComponent, ActionRow, ActionRowBuilder, ButtonBuilder, ButtonInteraction, ChannelType, CommandInteraction, EmbedBuilder, GuildMember, MessageActionRowComponent } from \"discord.js\";\nimport { log } from \"./logs\";\nimport { ExtendedClient, TicketType } from \"../structure\";\n\nexport const claim = async (interaction: ButtonInteraction | CommandInteraction, client: ExtendedClient) => {\n\t// Channel Sanity Checks to keep the code smaller ig?\n\tif (!interaction.channel || interaction.channel.type !== ChannelType.GuildText)\n\t\treturn await interaction.reply({\n\t\t\tcontent: \"This command can only be used in a ticket channel.\",\n\t\t\tephemeral: true\n\t\t});\n\n\tlet ticket = await client.prisma.tickets.findUnique({\n\t\twhere: {\n\t\t\tchannelid: interaction.channel.id\n\t\t}\n\t});\n\tconst claimed = ticket?.claimedat && ticket.claimedby;\n\n\tif (!ticket)\n\t\treturn interaction.reply({\n\t\t\tcontent: \"Ticket not found\",\n\t\t\tephemeral: true,\n\t\t});\n\n\t// @TODO: Breaking change refactor happens here as well..\n\tconst ticketType = ticket ? JSON.parse(ticket.category) as TicketType : undefined;\n\tconst canClaim = (interaction.member as GuildMember | null)?.roles.cache.some((r) => client.config.rolesWhoHaveAccessToTheTickets.includes(r.id) ||\n\t\tticketType?.staffRoles?.includes(r.id));\n\n\tif (!canClaim)\n\t\treturn interaction\n\t\t\t.reply({\n\t\t\t\tcontent: client.locales.getValue(\"ticketOnlyClaimableByStaff\"),\n\t\t\t\tephemeral: true,\n\t\t\t})\n\t\t\t.catch((e) => console.log(e));\n\n\tif (claimed)\n\t\treturn interaction\n\t\t\t.reply({\n\t\t\t\tcontent: client.locales.getValue(\"ticketAlreadyClaimed\"),\n\t\t\t\tephemeral: true,\n\t\t\t})\n\t\t\t.catch((e) => console.log(e));\n\n\tlog(\n\t\t{\n\t\t\tLogType: \"ticketClaim\",\n\t\t\tuser: interaction.user,\n\t\t\tticketId: ticket.id.toString(),\n\t\t\tticketChannelId: interaction.channel.id,\n\t\t\tticketCreatedAt: ticket.createdat,\n\t\t},\n\t\tclient\n\t);\n\n\tticket = await client.prisma.tickets.update({\n\t\tdata: {\n\t\t\tclaimedby: interaction.user.id,\n\t\t\tclaimedat: Date.now()\n\t\t},\n\t\twhere: {\n\t\t\tchannelid: interaction.channel.id,\n\t\t}\n\t});\n\n\tconst msg = await interaction.channel.messages.fetch(ticket.messageid);\n\tconst oldEmbed = msg?.embeds[0].data;\n\tconst newEmbed = new EmbedBuilder(oldEmbed)\n\t\t.setDescription(oldEmbed?.description + `\\n\\n ${client.locales.getSubValue(\"other\", \"claimedBy\").replace(\"USER\", `<@${interaction.user.id}>`)}`);\n\n\tconst row = new ActionRowBuilder<ButtonBuilder>();\n\t(msg?.components[0] as ActionRow<MessageActionRowComponent>)?.components.map((x) => {\n\t\tconst btnBuilder = new ButtonBuilder(x.data as APIButtonComponent);\n\t\tif (x.customId === \"claim\") btnBuilder.setDisabled(true);\n\t\trow.addComponents(btnBuilder);\n\t});\n\tmsg?.edit({\n\t\tcontent: msg.content,\n\t\tembeds: [newEmbed],\n\t\tcomponents: [row],\n\t}).catch((e) => console.log(e));\n\n\tinteraction\n\t\t.reply({\n\t\t\tcontent: client.locales.getValue(\"ticketClaimedMessage\").replace(\"USER\", `<@${interaction.user.id}>`),\n\t\t\tephemeral: false,\n\t\t})\n\t\t.catch((e) => console.log(e));\n\n\tconst defaultName = client.config.claimOption.nameWhenClaimed;\n\tif (defaultName && defaultName.trim() !== \"\") {\n\t\tconst creatorUser = await client.users.fetch(ticket.creator);\n\t\tconst newName = defaultName\n\t\t\t.replaceAll(\"S_USERNAME\", interaction.user.username)\n\t\t\t.replaceAll(\"U_USERNAME\", creatorUser.username)\n\t\t\t.replaceAll(\"S_USERID\", interaction.user.id)\n\t\t\t.replaceAll(\"U_USERID\", creatorUser.id)\n\t\t\t.replaceAll(\"TICKETCOUNT\", ticket.id.toString());\n\t\tawait interaction.channel.setName(newName).catch((e) => console.log(e));\n\t}\n\n\t// Move to claimed category when ticket is claimed\n\tconst categoryID = client.config.claimOption.categoryWhenClaimed;\n\tif (categoryID && categoryID.trim() !== \"\") {\n\t\tconst category = await interaction.guild?.channels.fetch(categoryID);\n\t\tif (category?.type !== ChannelType.GuildCategory)\n\t\t\treturn console.error(\"claim.ts: USER ERROR - Invalid categoryWhenClaimed ID. Channel must be a category.\");\n\t\tconst oldPerm = interaction.channel.permissionOverwrites.cache;\n\t\tawait interaction.channel.setParent(category);\n\t\tif (oldPerm)\n\t\t\tawait interaction.channel.permissionOverwrites.set(oldPerm);\n\t}\n};\n"]}